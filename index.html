<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Link ‚Äî Something Cool</title>
  <link rel="stylesheet" href="styles/main.css">
</head>

<body>
  <div class="wrap">
    <header class="site-title">
      <div class="logo">
        <img src="https://i.redd.it/link-twilight-princess-version-v0-8yonopyzy6fc1.jpg?width=526&format=pjpg&auto=webp&s=ccdcf9d64d8b56ccafdfc557c764bb14a06ae70b" alt="Link">
      </div>
      <div>
        <h1>Link</h1>
        <p class="lead">Because I was bored.</p>
      </div>
    </header>

    <div class="layout">
      <div class="main-col">
        <main class="card" role="main">
          <div class="titlebar">
            <div class="title">
              <span>üìù</span>
              <span>Blog Posts</span>
            </div>
            <div class="window-controls">
              <button class="min" title="Minimize">‚Äì</button>
              <button class="max" title="Maximize">‚ñ°</button>
              <button class="close" title="Close">√ó</button>
            </div>
          </div>

          <div class="content-inner">
            <div id="posts-container">
              <p style="color: #66cc88;">Loading posts...</p>
            </div>
          </div>
        </main>
      </div>

      <div class="side-col">
        <aside class="meta">
          <div class="panel">
            <h3>About</h3>
            <small>Bored programmer who mostly does things out of spite. Currently working on 4 projects at the same time.</small>
          </div>

          <div class="panel">
            <h3>Quick links</h3>
            <small>
              <a href="index.html" class="quicklink">Home</a><br>
              <a href="projects.html" class="quicklink">Projects</a><br>
              <a href="admin.html" class="quicklink">Admin</a>
            </small>
          </div>

          <div class="panel">
            <h3>Stats</h3>
            <small>
              <strong>Posts:</strong> <span id="post-count">0</span><br>
              <strong>Since:</strong> 2025<br>
              <strong>Status:</strong> <span style="color: #00ff66;">‚óè Online</span>
            </small>
          </div>
        </aside>
      </div>
    </div>

    <footer>
      <button class="start-orb" aria-label="Start"></button>
      <div class="taskbar-label">Hey! Listen!</div>
    </footer>
  </div>

  <script>
    async function loadPosts() {
      try {
        const response = await fetch('/api/posts');
        const posts = await response.json();
        
        const container = document.getElementById('posts-container');
        const countEl = document.getElementById('post-count');
        
        if (posts.length === 0) {
          container.innerHTML = '<p>No posts yet. <a href="admin.html" class="quicklink">Create one!</a></p>';
          return;
        }

        countEl.textContent = posts.length;
        
        container.innerHTML = posts.slice(0, 5).map(post => {
          const date = new Date(post.date).toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'long',
            day: 'numeric'
          });
          
          return `
            <article class="content">
              <h2 class="post-title">${escapeHtml(post.title)}</h2>
              <div class="post-meta">Posted on ${date}</div>
              <p class="post-body">${escapeHtml(post.body.substring(0, 300))}${post.body.length > 300 ? '...' : ''}</p>
              <a class="cta" href="post.html?id=${post.id}">
                <span>Read more</span>
                <span class="arrow">‚Üí</span>
              </a>
              ${post.status ? `
              <section class="mini-post">
                <div class="dot"></div>
                <div>
                  <strong class="post-mini-title">Currently</strong>
                  <small class="post-mini-desc">${escapeHtml(post.status)}</small>
                </div>
              </section>
              ` : ''}
            </article>
            ${posts.indexOf(post) < 4 ? '<hr style="border: 1px dashed #00cc55; margin: 20px 0;">' : ''}
          `;
        }).join('');
        
      } catch (error) {
        document.getElementById('posts-container').innerHTML = 
          '<p style="color: #ff6666;">Error loading posts. Make sure the server is running!</p>';
      }
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    loadPosts();
  </script>
</body>
</html>
