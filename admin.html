<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Admin ‚Äî Link</title>
  <link rel="stylesheet" href="styles/main.css">
</head>

<body>
  <div class="wrap">
    <header class="site-title">
      <div class="logo">
        <img src="https://i.redd.it/link-twilight-princess-version-v0-8yonopyzy6fc1.jpg?width=526&format=pjpg&auto=webp&s=ccdcf9d64d8b56ccafdfc557c764bb14a06ae70b" alt="Link">
      </div>
      <div>
        <h1>Admin Panel</h1>
        <p class="lead">Manage your blog posts</p>
      </div>
    </header>

    <div class="layout">
      <div class="main-col">
        <div class="card">
          <div class="titlebar">
            <div class="title">
              <span>‚úèÔ∏è</span>
              <span>Create New Post</span>
            </div>
            <div class="window-controls">
              <button class="min">‚Äì</button>
              <button class="max">‚ñ°</button>
              <button class="close">√ó</button>
            </div>
          </div>

          <div class="content-inner">
            <form id="post-form">
              <div class="form-group">
                <label for="title">Post Title:</label>
                <input type="text" id="title" name="title" required placeholder="Enter post title...">
              </div>

              <div class="form-group">
                <label for="body">Post Content:</label>
                <textarea id="body" name="body" required placeholder="Write your post here..."></textarea>
              </div>

              <div class="form-group">
                <label for="status">Current Status (optional):</label>
                <input type="text" id="status" name="status" placeholder="What are you working on?">
              </div>

              <button type="submit" class="btn">
                üìù Create Post
              </button>
              <button type="reset" class="btn" style="background: linear-gradient(180deg, #999 0%, #666 100%);">
                üîÑ Clear
              </button>
            </form>

            <div id="message" style="margin-top: 15px; padding: 10px; display: none;"></div>
          </div>
        </div>

        <div class="card" style="margin-top: 20px;">
          <div class="titlebar">
            <div class="title">
              <span>üìã</span>
              <span>All Posts</span>
            </div>
            <div class="window-controls">
              <button class="min">‚Äì</button>
              <button class="max">‚ñ°</button>
              <button class="close">√ó</button>
            </div>
          </div>

          <div class="content-inner">
            <ul id="posts-list" class="post-list">
              <li style="color: #66cc88;">Loading posts...</li>
            </ul>
          </div>
        </div>
      </div>

      <div class="side-col">
        <aside class="meta">
          <div class="panel">
            <h3>Quick Tips</h3>
            <small>
              ‚Ä¢ Use line breaks for paragraphs<br>
              ‚Ä¢ Keep titles short and catchy<br>
              ‚Ä¢ Status shows on the latest post<br>
              ‚Ä¢ Posts appear newest first
            </small>
          </div>

          <div class="panel">
            <h3>Quick links</h3>
            <small>
              <a href="index.html" class="quicklink">Home</a><br>
              <a href="projects.html" class="quicklink">Projects</a>
            </small>
          </div>
        </aside>
      </div>
    </div>

    <footer>
      <button class="start-orb" aria-label="Start"></button>
      <div class="taskbar-label">Admin Mode Active</div>
    </footer>
  </div>

  <script>
    const form = document.getElementById('post-form');
    const message = document.getElementById('message');
    const postsList = document.getElementById('posts-list');

    function showMessage(text, isError = false) {
      message.textContent = text;
      message.style.display = 'block';
      message.style.background = isError ? 'rgba(255, 100, 100, 0.2)' : 'rgba(0, 255, 100, 0.2)';
      message.style.border = isError ? '2px solid #ff6666' : '2px solid #00ff66';
      message.style.color = isError ? '#ff9999' : '#00ff66';
      
      setTimeout(() => {
        message.style.display = 'none';
      }, 3000);
    }

    function escapeHtml(text) {
      const div = document.createElement('div');
      div.textContent = text;
      return div.innerHTML;
    }

    async function loadPosts() {
      try {
        const response = await fetch('/api/posts');
        const posts = await response.json();
        
        if (posts.length === 0) {
          postsList.innerHTML = '<li>No posts yet.</li>';
          return;
        }

        postsList.innerHTML = posts.map(post => {
          const date = new Date(post.date).toLocaleDateString('en-US', {
            year: 'numeric',
            month: 'short',
            day: 'numeric',
            hour: '2-digit',
            minute: '2-digit'
          });
          
          return `
            <li>
              <h3>${escapeHtml(post.title)}</h3>
              <small style="color: #66cc88;">${date}</small>
              <p style="margin: 8px 0; font-size: 0.9rem;">${escapeHtml(post.body.substring(0, 150))}${post.body.length > 150 ? '...' : ''}</p>
              <a href="post.html?id=${post.id}" class="btn" style="font-size: 0.8rem; padding: 5px 10px;">View</a>
              <button class="btn btn-delete" style="font-size: 0.8rem; padding: 5px 10px;" onclick="deletePost(${post.id})">Delete</button>
            </li>
          `;
        }).join('');
        
      } catch (error) {
        postsList.innerHTML = '<li style="color: #ff6666;">Error loading posts!</li>';
      }
    }

    async function deletePost(id) {
      if (!confirm('Are you sure you want to delete this post?')) {
        return;
      }
      
      try {
        const response = await fetch(`/api/posts/${id}`, {
          method: 'DELETE'
        });
        
        if (response.ok) {
          showMessage('Post deleted successfully!');
          loadPosts();
        } else {
          showMessage('Failed to delete post', true);
        }
      } catch (error) {
        showMessage('Error deleting post', true);
      }
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      
      const formData = {
        title: document.getElementById('title').value,
        body: document.getElementById('body').value,
        status: document.getElementById('status').value
      };
      
      try {
        const response = await fetch('/api/posts', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify(formData)
        });
        
        if (response.ok) {
          showMessage('Post created successfully!');
          form.reset();
          loadPosts();
        } else {
          showMessage('Failed to create post', true);
        }
      } catch (error) {
        showMessage('Error creating post', true);
      }
    });

    loadPosts();
  </script>
</body>
</html>
